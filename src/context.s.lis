1     0000              MODULE context_s
2     0000              LINE 0, "src/context.s"
0     0000              
1     0000              INCLUDE "config_scz180_private.inc"
1     0000              
2     0000              
3     0000              
4     0000              
5     0000              IFNDEF __CONFIG_Z88DK_INC_
6     0000              defc   __CONFIG_Z88DK_INC_ = 1
7     0000              
8     0000              ; Automatically Generated at Library Build Time
9     0000              
10    0000              
11    0000              
12    0000              
13    0000              
14    0000              
15    0000              
16    0000              
17    0000              
18    0000              
19    0000              
20    0000              
21    0000              
22    0000              defc __Z88DK = 1992
23    0000              
24    0000              
25    0000              
26    0000              
27    0000              
28    0000              
29    0000              
30    0000              
31    0000              
32    0000              
33    0000              
34    0000              
35    0000              defc __SCZ180 = 1
36    0000              
37    0000              defc __CPU_CLOCK = 18432000
38    0000              
39    0000              defc __CLOCKS_PER_SECOND = 50
40    0000              
41    0000              defc __ASCI0_RX_SIZE = 0x100
42    0000              defc __ASCI0_TX_SIZE = 0x080
43    0000              
44    0000              defc __ASCI1_RX_SIZE = 0x100
45    0000              defc __ASCI1_TX_SIZE = 0x080
46    0000              
47    0000              defc __IO_BASE_ADDRESS = 0xc0
48    0000              
49    0000              defc __IO_DIO_PORT = 0x00
50    0000              
51    0000              defc __IO_SYSTEM = 0x0C
52    0000              defc __IO_LED_OUTPUT = 0x0D
53    0000              defc __IO_LED_STATUS = 0x0E
54    0000              
55    0000              defc __IO_CF_PORT = 0x10
56    0000              
57    0000              
58    0000              
59    0000              
60    0000              
61    0000              
62    0000              
63    0000              
64    0000              
65    0000              
66    0000              
67    0000              
68    0000              defc __Z180 = 0x04
69    0000              
70    0000              defc __Z180_Z80180 = 0x01
71    0000              defc __Z180_Z8L180 = 0x02
72    0000              defc __Z180_Z8S180 = 0x04
73    0000              
74    0000              defc __CPU_INFO = 0x00
75    0000              
76    0000              defc __CPU_INFO_ENABLE_SLL = 0x01
77    0000              
78    0000              defc __CPU_TIMER_SCALE = 20
79    0000              
80    0000              
81    0000                 ; Z8S180 / Z8L180 CLASS
82    0000              
83    0000                 defc CNTLA0 = 0xc0
84    0000                 defc CNTLA1 = 0xc1
85    0000                 defc CNTLB0 = 0xc2
86    0000                 defc CNTLB1 = 0xc3
87    0000                 defc STAT0 = 0xc4
88    0000                 defc STAT1 = 0xc5
89    0000                 defc TDR0 = 0xc6
90    0000                 defc TDR1 = 0xc7
91    0000                 defc RDR0 = 0xc8
92    0000                 defc RDR1 = 0xc9
93    0000                 defc ASEXT0 = 0xd2
94    0000                 defc ASEXT1 = 0xd3
95    0000                 defc ASTC0L = 0xda
96    0000                 defc ASTC0H = 0xdb
97    0000                 defc ASTC1L = 0xdc
98    0000                 defc ASTC1H = 0xdd
99    0000              
100   0000                 defc CNTR = 0xca
101   0000                 defc TRDR = 0xcb
102   0000              
103   0000                 defc TMDR0L = 0xcc
104   0000                 defc TMDR0H = 0xcd
105   0000                 defc RLDR0L = 0xce
106   0000                 defc RLDR0H = 0xcf
107   0000                 defc TCR = 0xd0
108   0000                 defc TMDR1L = 0xd4
109   0000                 defc TMDR1H = 0xd5
110   0000                 defc RLDR1L = 0xd6
111   0000                 defc RLDR1H = 0xd7
112   0000              
113   0000                 defc FRC = 0xd8
114   0000                 defc CMR = 0xde
115   0000                 defc CCR = 0xdf
116   0000              
117   0000                 defc SAR0L = 0xe0
118   0000                 defc SAR0H = 0xe1
119   0000                 defc SAR0B = 0xe2
120   0000                 defc DAR0L = 0xe3
121   0000                 defc DAR0H = 0xe4
122   0000                 defc DAR0B = 0xe5
123   0000                 defc BCR0L = 0xe6
124   0000                 defc BCR0H = 0xe7
125   0000                 defc MAR1L = 0xe8
126   0000                 defc MAR1H = 0xe9
127   0000                 defc MAR1B = 0xea
128   0000                 defc IAR1L = 0xeb
129   0000                 defc IAR1H = 0xec
130   0000                 defc IAR1B = 0xed
131   0000                 defc BCR1L = 0xee
132   0000                 defc BCR1H = 0xef
133   0000                 defc DSTAT = 0xf0
134   0000                 defc DMODE = 0xf1
135   0000                 defc DCNTL = 0xf2
136   0000              
137   0000                 defc IL = 0xf3
138   0000                 defc ITC = 0xf4
139   0000              
140   0000                 defc RCR = 0xf6
141   0000              
142   0000                 defc CBR = 0xf8
143   0000                 defc BBR = 0xf9
144   0000                 defc CBAR = 0xfa
145   0000              
146   0000                 defc OMCR = 0xfe
147   0000                 defc ICR = 0x3f
148   0000              
149   0000                 ; I/O REGISTER BIT FIELDS
150   0000              
151   0000                 defc CNTLA0_MPE = 0x80
152   0000                 defc CNTLA0_RE = 0x40
153   0000                 defc CNTLA0_TE = 0x20
154   0000                 defc CNTLA0_RTS0 = 0x10
155   0000                 defc CNTLA0_MPBR = 0x08
156   0000                 defc CNTLA0_EFR = 0x08
157   0000                 defc CNTLA0_MODE_MASK = 0x07
158   0000                 defc CNTLA0_MODE_8P2 = 0x07
159   0000                 defc CNTLA0_MODE_8P1 = 0x06
160   0000                 defc CNTLA0_MODE_8N2 = 0x05
161   0000                 defc CNTLA0_MODE_8N1 = 0x04
162   0000                 defc CNTLA0_MODE_7P2 = 0x03
163   0000                 defc CNTLA0_MODE_7P1 = 0x02
164   0000                 defc CNTLA0_MODE_7N2 = 0x01
165   0000                 defc CNTLA0_MODE_7N1 = 0x00
166   0000              
167   0000                 defc CNTLA1_MPE = 0x80
168   0000                 defc CNTLA1_RE = 0x40
169   0000                 defc CNTLA1_TE = 0x20
170   0000                 defc CNTLA1_CKA1D = 0x10
171   0000                 defc CNTLA1_MPBR = 0x08
172   0000                 defc CNTLA1_EFR = 0x08
173   0000                 defc CNTLA1_MODE_MASK = 0x07
174   0000                 defc CNTLA1_MODE_8P2 = 0x07
175   0000                 defc CNTLA1_MODE_8P1 = 0x06
176   0000                 defc CNTLA1_MODE_8N2 = 0x05
177   0000                 defc CNTLA1_MODE_8N1 = 0x04
178   0000                 defc CNTLA1_MODE_7P2 = 0x03
179   0000                 defc CNTLA1_MODE_7P1 = 0x02
180   0000                 defc CNTLA1_MODE_7N2 = 0x01
181   0000                 defc CNTLA1_MODE_7N1 = 0x00
182   0000              
183   0000                 defc CNTLB0_MPBT = 0x80
184   0000                 defc CNTLB0_MP = 0x40
185   0000                 defc CNTLB0_CTS = 0x20
186   0000                 defc CNTLB0_PS = 0x20
187   0000                 defc CNTLB0_PEO = 0x10
188   0000                 defc CNTLB0_DR = 0x08
189   0000                 defc CNTLB0_SS_MASK = 0x07
190   0000                 defc CNTLB0_SS_EXT = 0x07
191   0000                 defc CNTLB0_SS_DIV_64 = 0x06
192   0000                 defc CNTLB0_SS_DIV_32 = 0x05
193   0000                 defc CNTLB0_SS_DIV_16 = 0x04
194   0000                 defc CNTLB0_SS_DIV_8 = 0x03
195   0000                 defc CNTLB0_SS_DIV_4 = 0x02
196   0000                 defc CNTLB0_SS_DIV_2 = 0x01
197   0000                 defc CNTLB0_SS_DIV_1 = 0x00
198   0000              
199   0000                 defc CNTLB1_MPBT = 0x80
200   0000                 defc CNTLB1_MP = 0x40
201   0000                 defc CNTLB1_CTS = 0x20
202   0000                 defc CNTLB1_PS = 0x20
203   0000                 defc CNTLB1_PEO = 0x10
204   0000                 defc CNTLB1_DR = 0x08
205   0000                 defc CNTLB1_SS_MASK = 0x07
206   0000                 defc CNTLB1_SS_EXT = 0x07
207   0000                 defc CNTLB1_SS_DIV_64 = 0x06
208   0000                 defc CNTLB1_SS_DIV_32 = 0x05
209   0000                 defc CNTLB1_SS_DIV_16 = 0x04
210   0000                 defc CNTLB1_SS_DIV_8 = 0x03
211   0000                 defc CNTLB1_SS_DIV_4 = 0x02
212   0000                 defc CNTLB1_SS_DIV_2 = 0x01
213   0000                 defc CNTLB1_SS_DIV_1 = 0x00
214   0000              
215   0000                 defc STAT0_RDRF = 0x80
216   0000                 defc STAT0_OVRN = 0x40
217   0000                 defc STAT0_PE = 0x20
218   0000                 defc STAT0_FE = 0x10
219   0000                 defc STAT0_RIE = 0x08
220   0000                 defc STAT0_DCD0 = 0x04
221   0000                 defc STAT0_TDRE = 0x02
222   0000                 defc STAT0_TIE = 0x01
223   0000              
224   0000                 defc STAT1_RDRF = 0x80
225   0000                 defc STAT1_OVRN = 0x40
226   0000                 defc STAT1_PE = 0x20
227   0000                 defc STAT1_FE = 0x10
228   0000                 defc STAT1_RIE = 0x08
229   0000                 defc STAT1_CTS1E = 0x04
230   0000                 defc STAT1_TDRE = 0x02
231   0000                 defc STAT1_TIE = 0x01
232   0000              
233   0000                 defc CNTR_EF = 0x80
234   0000                 defc CNTR_EIE = 0x40
235   0000                 defc CNTR_RE = 0x20
236   0000                 defc CNTR_TE = 0x10
237   0000                 defc CNTR_SS_MASK = 0x07
238   0000                 defc CNTR_SS_EXT = 0x07
239   0000                 defc CNTR_SS_DIV_1280 = 0x06
240   0000                 defc CNTR_SS_DIV_640 = 0x05
241   0000                 defc CNTR_SS_DIV_320 = 0x04
242   0000                 defc CNTR_SS_DIV_160 = 0x03
243   0000                 defc CNTR_SS_DIV_80 = 0x02
244   0000                 defc CNTR_SS_DIV_40 = 0x01
245   0000                 defc CNTR_SS_DIV_20 = 0x00
246   0000              
247   0000                 ; PRT REGISTER BIT FIELDS
248   0000              
249   0000                 defc TCR_TIF1 = 0x80
250   0000                 defc TCR_TIF0 = 0x40
251   0000                 defc TCR_TIE1 = 0x20
252   0000                 defc TCR_TIE0 = 0x10
253   0000                 defc TCR_TOC1 = 0x08
254   0000                 defc TCR_TOC0 = 0x04
255   0000                 defc TCR_TDE1 = 0x02
256   0000                 defc TCR_TDE0 = 0x01
257   0000              
258   0000                 ; DMA REGISTER BIT FIELDS
259   0000              
260   0000                 defc DSTAT_DE1 = 0x80
261   0000                 defc DSTAT_DE0 = 0x40
262   0000                 defc DSTAT_DWE1 = 0x20
263   0000                 defc DSTAT_DWE0 = 0x10
264   0000                 defc DSTAT_DIE1 = 0x08
265   0000                 defc DSTAT_DIE0 = 0x04
266   0000                 defc DSTAT_DME = 0x01
267   0000              
268   0000                 defc DMODE_DM1 = 0x20
269   0000                 defc DMODE_DM0 = 0x10
270   0000                 defc DMODE_SM1 = 0x08
271   0000                 defc DMODE_SM0 = 0x04
272   0000                 defc DMODE_MMOD = 0x02
273   0000              
274   0000                 defc DCNTL_MWI1 = 0x80
275   0000                 defc DCNTL_MWI0 = 0x40
276   0000                 defc DCNTL_IWI1 = 0x20
277   0000                 defc DCNTL_IWI0 = 0x10
278   0000                 defc DCNTL_DMS1 = 0x08
279   0000                 defc DCNTL_DMS0 = 0x04
280   0000                 defc DCNTL_DIM1 = 0x02
281   0000                 defc DCNTL_DIM0 = 0x01
282   0000              
283   0000                 ; INT/TRAP CONTROL REGISTER (ITC) BIT FIELDS
284   0000              
285   0000                 defc ITC_TRAP = 0x80
286   0000                 defc ITC_UFO = 0x40
287   0000                 defc ITC_ITE2 = 0x04
288   0000                 defc ITC_ITE1 = 0x02
289   0000                 defc ITC_ITE0 = 0x01
290   0000              
291   0000                 ; Refresh CONTROL REGISTER (RCR) BIT FIELDS
292   0000              
293   0000                 defc RCR_REFE = 0x80
294   0000                 defc RCR_REFW = 0x40
295   0000                 defc RCR_CYC1 = 0x02
296   0000                 defc RCR_CYC0 = 0x01
297   0000              
298   0000                 ; Operation Mode CONTROL REGISTER (OMCR) BIT FIELDS
299   0000              
300   0000                 defc OMCR_M1E = 0x80
301   0000                 defc OMCR_M1TE = 0x40
302   0000                 defc OMCR_IOC = 0x20
303   0000              
304   0000                 ; CPU CLOCK MULTIPLIER REGISTER (CMR) BIT FIELDS (Z8S180 & higher Only)
305   0000              
306   0000                 defc CMR_X2 = 0x80
307   0000                 defc CMR_LN_XTAL = 0x40
308   0000              
309   0000                 ; CPU CONTROL REGISTER (CCR) BIT FIELDS (Z8S180 & higher Only)
310   0000              
311   0000                 defc CCR_XTAL_X2 = 0x80
312   0000                 defc CCR_STANDBY = 0x40
313   0000                 defc CCR_BREXT = 0x20
314   0000                 defc CCR_LNPHI = 0x10
315   0000                 defc CCR_IDLE = 0x08
316   0000                 defc CCR_LNIO = 0x04
317   0000                 defc CCR_LNCPUCTL = 0x02
318   0000                 defc CCR_LNAD = 0x01
319   0000              
320   0000              
321   0000              
322   0000              
323   0000              
324   0000              
325   0000              
326   0000              
327   0000              
328   0000              
329   0000              
330   0000              
331   0000              
332   0000              defc __CLIB_OPT_MULTITHREAD = 0x00
333   0000              
334   0000              defc __CLIB_OPT_MULTITHREAD_LOCK_HEAPS = 0x01
335   0000              defc __CLIB_OPT_MULTITHREAD_LOCK_FILES = 0x02
336   0000              defc __CLIB_OPT_MULTITHREAD_LOCK_FLIST = 0x04
337   0000              defc __CLIB_OPT_MULTITHREAD_LOCK_FDTBL = 0x08
338   0000              defc __CLIB_OPT_MULTITHREAD_LOCK_FDSTR = 0x10
339   0000              
340   0000              defc __CLIB_OPT_IMATH = 0
341   0000              
342   0000              defc __CLIB_OPT_IMATH_FAST = 0x0f
343   0000              
344   0000              defc __CLIB_OPT_IMATH_FAST_DIV_UNROLL = 0x01
345   0000              defc __CLIB_OPT_IMATH_FAST_DIV_LZEROS = 0x02
346   0000              defc __CLIB_OPT_IMATH_FAST_MUL_UNROLL = 0x04
347   0000              defc __CLIB_OPT_IMATH_FAST_MUL_LZEROS = 0x08
348   0000              defc __CLIB_OPT_IMATH_FAST_LIA = 0x80
349   0000              
350   0000              defc __CLIB_OPT_IMATH_SELECT = 0x00
351   0000              
352   0000              defc __CLIB_OPT_IMATH_SELECT_FAST_ASR = 0x01
353   0000              defc __CLIB_OPT_IMATH_SELECT_FAST_LSR = 0x02
354   0000              defc __CLIB_OPT_IMATH_SELECT_FAST_LSL = 0x04
355   0000              
356   0000              defc __CLIB_OPT_TXT2NUM = 0x04
357   0000              
358   0000              defc __CLIB_OPT_TXT2NUM_INT_BIN = 0x01
359   0000              defc __CLIB_OPT_TXT2NUM_INT_OCT = 0x02
360   0000              defc __CLIB_OPT_TXT2NUM_INT_DEC = 0x04
361   0000              defc __CLIB_OPT_TXT2NUM_INT_HEX = 0x08
362   0000              
363   0000              defc __CLIB_OPT_TXT2NUM_LONG_BIN = 0x10
364   0000              defc __CLIB_OPT_TXT2NUM_LONG_OCT = 0x20
365   0000              defc __CLIB_OPT_TXT2NUM_LONG_DEC = 0x40
366   0000              defc __CLIB_OPT_TXT2NUM_LONG_HEX = 0x80
367   0000              
368   0000              defc __CLIB_OPT_TXT2NUM_SELECT = 0x00
369   0000              
370   0000              defc __CLIB_OPT_TXT2NUM_SELECT_FAST_BIN = 0x01
371   0000              defc __CLIB_OPT_TXT2NUM_SELECT_FAST_OCT = 0x02
372   0000              defc __CLIB_OPT_TXT2NUM_SELECT_FAST_DEC = 0x04
373   0000              defc __CLIB_OPT_TXT2NUM_SELECT_FAST_HEX = 0x08
374   0000              
375   0000              defc __CLIB_OPT_NUM2TXT = 0x00
376   0000              
377   0000              defc __CLIB_OPT_NUM2TXT_INT_BIN = 0x01
378   0000              defc __CLIB_OPT_NUM2TXT_INT_OCT = 0x02
379   0000              defc __CLIB_OPT_NUM2TXT_INT_DEC = 0x04
380   0000              defc __CLIB_OPT_NUM2TXT_INT_HEX = 0x08
381   0000              
382   0000              defc __CLIB_OPT_NUM2TXT_LONG_BIN = 0x10
383   0000              defc __CLIB_OPT_NUM2TXT_LONG_OCT = 0x20
384   0000              defc __CLIB_OPT_NUM2TXT_LONG_DEC = 0x40
385   0000              defc __CLIB_OPT_NUM2TXT_LONG_HEX = 0x80
386   0000              
387   0000              defc __CLIB_OPT_NUM2TXT_SELECT = 0x00
388   0000              
389   0000              defc __CLIB_OPT_NUM2TXT_SELECT_FAST_BIN = 0x01
390   0000              defc __CLIB_OPT_NUM2TXT_SELECT_FAST_OCT = 0x02
391   0000              defc __CLIB_OPT_NUM2TXT_SELECT_FAST_DEC = 0x04
392   0000              defc __CLIB_OPT_NUM2TXT_SELECT_FAST_HEX = 0x08
393   0000              
394   0000              defc __CLIB_OPT_STDIO = 0x00
395   0000              
396   0000              defc __CLIB_OPT_STDIO_VALID = 0x01
397   0000              
398   0000              defc CHAR_CR = 13
399   0000              defc CHAR_LF = 10
400   0000              defc CHAR_BS = 8
401   0000              defc CHAR_ESC = 27
402   0000              defc CHAR_CAPS = 6
403   0000              defc CHAR_BELL = 7
404   0000              defc CHAR_CTRL_C = 3
405   0000              defc CHAR_CTRL_D = 4
406   0000              defc CHAR_CTRL_Z = 26
407   0000              defc CHAR_CURSOR_UC = 45
408   0000              defc CHAR_CURSOR_LC = 95
409   0000              defc CHAR_PASSWORD = 42
410   0000              
411   0000              defc __CLIB_OPT_PRINTF = 0x002ff6ff
412   0000              
413   0000              defc __CLIB_OPT_PRINTF_d = 0x00000001
414   0000              defc __CLIB_OPT_PRINTF_u = 0x00000002
415   0000              defc __CLIB_OPT_PRINTF_x = 0x00000004
416   0000              defc __CLIB_OPT_PRINTF_X = 0x00000008
417   0000              defc __CLIB_OPT_PRINTF_o = 0x00000010
418   0000              defc __CLIB_OPT_PRINTF_n = 0x00000020
419   0000              defc __CLIB_OPT_PRINTF_i = 0x00000040
420   0000              defc __CLIB_OPT_PRINTF_p = 0x00000080
421   0000              defc __CLIB_OPT_PRINTF_B = 0x00000100
422   0000              defc __CLIB_OPT_PRINTF_s = 0x00000200
423   0000              defc __CLIB_OPT_PRINTF_c = 0x00000400
424   0000              defc __CLIB_OPT_PRINTF_I = 0x00000800
425   0000              defc __CLIB_OPT_PRINTF_ld = 0x00001000
426   0000              defc __CLIB_OPT_PRINTF_lu = 0x00002000
427   0000              defc __CLIB_OPT_PRINTF_lx = 0x00004000
428   0000              defc __CLIB_OPT_PRINTF_lX = 0x00008000
429   0000              defc __CLIB_OPT_PRINTF_lo = 0x00010000
430   0000              defc __CLIB_OPT_PRINTF_ln = 0x00020000
431   0000              defc __CLIB_OPT_PRINTF_li = 0x00040000
432   0000              defc __CLIB_OPT_PRINTF_lp = 0x00080000
433   0000              defc __CLIB_OPT_PRINTF_lB = 0x00100000
434   0000              defc __CLIB_OPT_PRINTF_a = 0x00400000
435   0000              defc __CLIB_OPT_PRINTF_A = 0x00800000
436   0000              defc __CLIB_OPT_PRINTF_e = 0x01000000
437   0000              defc __CLIB_OPT_PRINTF_E = 0x02000000
438   0000              defc __CLIB_OPT_PRINTF_f = 0x04000000
439   0000              defc __CLIB_OPT_PRINTF_F = 0x08000000
440   0000              defc __CLIB_OPT_PRINTF_g = 0x10000000
441   0000              defc __CLIB_OPT_PRINTF_G = 0x20000000
442   0000              
443   0000              defc __CLIB_OPT_PRINTF_2 = 0x00
444   0000              
445   0000              defc __CLIB_OPT_PRINTF_2_lld = 0x01
446   0000              defc __CLIB_OPT_PRINTF_2_llu = 0x02
447   0000              defc __CLIB_OPT_PRINTF_2_llx = 0x04
448   0000              defc __CLIB_OPT_PRINTF_2_llX = 0x08
449   0000              defc __CLIB_OPT_PRINTF_2_llo = 0x10
450   0000              defc __CLIB_OPT_PRINTF_2_lli = 0x40
451   0000              
452   0000              defc __CLIB_OPT_SCANF = 0x002ff6ff
453   0000              
454   0000              defc __CLIB_OPT_SCANF_d = 0x00000001
455   0000              defc __CLIB_OPT_SCANF_u = 0x00000002
456   0000              defc __CLIB_OPT_SCANF_x = 0x00000004
457   0000              defc __CLIB_OPT_SCANF_X = 0x00000008
458   0000              defc __CLIB_OPT_SCANF_o = 0x00000010
459   0000              defc __CLIB_OPT_SCANF_n = 0x00000020
460   0000              defc __CLIB_OPT_SCANF_i = 0x00000040
461   0000              defc __CLIB_OPT_SCANF_p = 0x00000080
462   0000              defc __CLIB_OPT_SCANF_B = 0x00000100
463   0000              defc __CLIB_OPT_SCANF_s = 0x00000200
464   0000              defc __CLIB_OPT_SCANF_c = 0x00000400
465   0000              defc __CLIB_OPT_SCANF_I = 0x00000800
466   0000              defc __CLIB_OPT_SCANF_ld = 0x00001000
467   0000              defc __CLIB_OPT_SCANF_lu = 0x00002000
468   0000              defc __CLIB_OPT_SCANF_lx = 0x00004000
469   0000              defc __CLIB_OPT_SCANF_lX = 0x00008000
470   0000              defc __CLIB_OPT_SCANF_lo = 0x00010000
471   0000              defc __CLIB_OPT_SCANF_ln = 0x00020000
472   0000              defc __CLIB_OPT_SCANF_li = 0x00040000
473   0000              defc __CLIB_OPT_SCANF_lp = 0x00080000
474   0000              defc __CLIB_OPT_SCANF_lB = 0x00100000
475   0000              defc __CLIB_OPT_SCANF_BRACKET = 0x00200000
476   0000              defc __CLIB_OPT_SCANF_a = 0x00400000
477   0000              defc __CLIB_OPT_SCANF_A = 0x00800000
478   0000              defc __CLIB_OPT_SCANF_e = 0x01000000
479   0000              defc __CLIB_OPT_SCANF_E = 0x02000000
480   0000              defc __CLIB_OPT_SCANF_f = 0x04000000
481   0000              defc __CLIB_OPT_SCANF_F = 0x08000000
482   0000              defc __CLIB_OPT_SCANF_g = 0x10000000
483   0000              defc __CLIB_OPT_SCANF_G = 0x20000000
484   0000              
485   0000              defc __CLIB_OPT_SCANF_2 = 0x00
486   0000              
487   0000              defc __CLIB_OPT_SCANF_2_lld = 0x01
488   0000              defc __CLIB_OPT_SCANF_2_llu = 0x02
489   0000              defc __CLIB_OPT_SCANF_2_llx = 0x04
490   0000              defc __CLIB_OPT_SCANF_2_llX = 0x08
491   0000              defc __CLIB_OPT_SCANF_2_llo = 0x10
492   0000              defc __CLIB_OPT_SCANF_2_lli = 0x40
493   0000              
494   0000              defc __CLIB_OPT_UNROLL = 0x00
495   0000              
496   0000              defc __CLIB_OPT_UNROLL_MEMCPY = 0x01
497   0000              defc __CLIB_OPT_UNROLL_MEMSET = 0x02
498   0000              defc __CLIB_OPT_UNROLL_OTIR = 0x10
499   0000              defc __CLIB_OPT_UNROLL_LDIR = 0x20
500   0000              defc __CLIB_OPT_UNROLL_USER_SMC = 0x40
501   0000              defc __CLIB_OPT_UNROLL_LIB_SMC = 0x80
502   0000              
503   0000              defc __CLIB_OPT_STRTOD = 0x00
504   0000              
505   0000              defc __CLIB_OPT_STRTOD_NAN = 0x01
506   0000              defc __CLIB_OPT_STRTOD_INF = 0x01
507   0000              defc __CLIB_OPT_STRTOD_HEX = 0x02
508   0000              
509   0000              defc __CLIB_OPT_SORT = 1
510   0000              
511   0000              defc __CLIB_OPT_SORT_INSERTION = 0
512   0000              defc __CLIB_OPT_SORT_SHELL = 1
513   0000              defc __CLIB_OPT_SORT_QUICK = 2
514   0000              
515   0000              defc __CLIB_OPT_SORT_QSORT = 0x0c
516   0000              
517   0000              defc __CLIB_OPT_SORT_QSORT_PIVOT = 0x3
518   0000              defc __CLIB_OPT_SORT_QSORT_PIVOT_MID = 0x0
519   0000              defc __CLIB_OPT_SORT_QSORT_PIVOT_RAN = 0x1
520   0000              defc __CLIB_OPT_SORT_QSORT_ENABLE_INSERTION = 0x04
521   0000              defc __CLIB_OPT_SORT_QSORT_ENABLE_EQUAL = 0x08
522   0000              
523   0000              defc __CLIB_OPT_ERROR = 0x00
524   0000              
525   0000              defc __CLIB_OPT_ERROR_ENABLED = 0x01
526   0000              defc __CLIB_OPT_ERROR_VERBOSE = 0x02
527   0000              
528   0000              
529   0000              
530   0000              
531   0000              
532   0000              
533   0000              
534   0000              
535   0000              
536   0000              
537   0000              
538   0000              
539   0000              
540   0000              
541   0000              
542   0000              
543   0000              defc __EOK = 0
544   0000              defc __EACCES = 1
545   0000              defc __EBADF = 2
546   0000              defc __EBDFD = 3
547   0000              defc __EDOM = 4
548   0000              defc __EFBIG = 5
549   0000              defc __EINVAL = 6
550   0000              defc __EIO = 7
551   0000              defc __EMFILE = 8
552   0000              defc __ENFILE = 9
553   0000              defc __ENOLCK = 10
554   0000              defc __ENOMEM = 11
555   0000              defc __ENOTSUP = 12
556   0000              defc __EOVERFLOW = 13
557   0000              defc __ERANGE = 14
558   0000              defc __ESTAT = 15
559   0000              defc __EAGAIN = 16
560   0000              defc __EWOULDBLOCK = 16
561   0000              
562   0000              defc __ERROR_NEXT = 50
563   0000              
564   0000              defc STDIO_SEEK_SET = 0
565   0000              defc STDIO_SEEK_CUR = 1
566   0000              defc STDIO_SEEK_END = 2
567   0000              
568   0000              defc STDIO_MSG_PUTC = 1
569   0000              defc STDIO_MSG_WRIT = 2
570   0000              defc STDIO_MSG_GETC = 3
571   0000              defc STDIO_MSG_EATC = 4
572   0000              defc STDIO_MSG_READ = 5
573   0000              defc STDIO_MSG_SEEK = 6
574   0000              defc STDIO_MSG_ICTL = 7
575   0000              defc STDIO_MSG_FLSH = 8
576   0000              defc STDIO_MSG_CLOS = 9
577   0000              
578   0000              defc ITERM_MSG_GETC = 15
579   0000              defc ITERM_MSG_REJECT = 16
580   0000              defc ITERM_MSG_INTERRUPT = 17
581   0000              defc ITERM_MSG_PUTC = 18
582   0000              defc ITERM_MSG_PRINT_CURSOR = 19
583   0000              defc ITERM_MSG_ERASE_CURSOR = 20
584   0000              defc ITERM_MSG_ERASE_CURSOR_PWD = 21
585   0000              defc ITERM_MSG_BS = 22
586   0000              defc ITERM_MSG_BS_PWD = 23
587   0000              defc ITERM_MSG_READLINE_BEGIN = 24
588   0000              defc ITERM_MSG_READLINE_END = 25
589   0000              defc ITERM_MSG_READLINE_SCROLL_LIMIT = 26
590   0000              defc ITERM_MSG_BELL = 27
591   0000              
592   0000              defc __MESSAGE_ITERM_NEXT__ = 28
593   0000              
594   0000              defc OTERM_MSG_PUTC = 30
595   0000              defc OTERM_MSG_TTY = 31
596   0000              defc OTERM_MSG_FZX_PUTC = 32
597   0000              defc OTERM_MSG_PRINTC = 33
598   0000              defc OTERM_MSG_SCROLL = 34
599   0000              defc OTERM_MSG_SCROLL_LIMIT = 35
600   0000              defc OTERM_MSG_CLS = 36
601   0000              defc OTERM_MSG_PAUSE = 37
602   0000              defc OTERM_MSG_BELL = 38
603   0000              defc OTERM_MSG_PSCROLL = 39
604   0000              defc OTERM_MSG_FZX_GET_XOR_DRAW = 40
605   0000              
606   0000              defc __MESSAGE_OTERM_NEXT__ = 41
607   0000              
608   0000              defc ICHAR_MSG_GETC = 15
609   0000              defc OCHAR_MSG_PUTC_BIN = 30
610   0000              defc OCHAR_MSG_PUTC = 33
611   0000              
612   0000              defc __MESSAGE_NEXT__ = 45
613   0000              
614   0000              defc mtx_plain = 0x01
615   0000              defc mtx_recursive = 0x02
616   0000              defc mtx_timed = 0x04
617   0000              
618   0000              defc thrd_success = 0x00
619   0000              defc thrd_error = 0x01
620   0000              defc thrd_nomem = 0x02
621   0000              defc thrd_busy = 0x04
622   0000              defc thrd_timedout = 0x08
623   0000              
624   0000              defc IOCTL_RESET = 0x0000
625   0000              
626   0000              defc IOCTL_ITERM_ECHO = 0xc081
627   0000              defc IOCTL_ITERM_PASS = 0xc041
628   0000              defc IOCTL_ITERM_LINE = 0xc021
629   0000              defc IOCTL_ITERM_COOK = 0xc011
630   0000              defc IOCTL_ITERM_CAPS = 0xc009
631   0000              defc IOCTL_ITERM_CRLF = 0xc101
632   0000              defc IOCTL_ITERM_CURS = 0xc201
633   0000              
634   0000              defc IOCTL_ITERM_TIE = 0x0201
635   0000              defc IOCTL_ITERM_GET_EDITBUF = 0x0381
636   0000              defc IOCTL_ITERM_SET_EDITBUF = 0x0301
637   0000              
638   0000              defc IOCTL_OTERM_PAGE = 0xc082
639   0000              defc IOCTL_OTERM_PAUSE = 0xc042
640   0000              defc IOCTL_OTERM_COOK = 0xc022
641   0000              defc IOCTL_OTERM_CRLF = 0xc012
642   0000              defc IOCTL_OTERM_CLEAR = 0xe002
643   0000              defc IOCTL_OTERM_SIGNAL = 0xc202
644   0000              defc IOCTL_OTERM_BELL = 0xc102
645   0000              
646   0000              defc IOCTL_OTERM_CLS = 0x0102
647   0000              defc IOCTL_OTERM_RESET_SCROLL = 0x0202
648   0000              defc IOCTL_OTERM_GET_WINDOW_COORD = 0x0382
649   0000              defc IOCTL_OTERM_SET_WINDOW_COORD = 0x0302
650   0000              defc IOCTL_OTERM_GET_WINDOW_RECT = 0x0482
651   0000              defc IOCTL_OTERM_SET_WINDOW_RECT = 0x0402
652   0000              defc IOCTL_OTERM_GET_CURSOR_COORD = 0x0582
653   0000              defc IOCTL_OTERM_SET_CURSOR_COORD = 0x0502
654   0000              defc IOCTL_OTERM_GET_OTERM = 0x0602
655   0000              defc IOCTL_OTERM_SCROLL = 0x0702
656   0000              defc IOCTL_OTERM_FONT = 0x0802
657   0000              defc IOCTL_OTERM_SCROLL_LIMIT = 0x0902
658   0000              
659   0000              defc IOCTL_OTERM_FZX_GET_PAPER_COORD = 0x0a82
660   0000              defc IOCTL_OTERM_FZX_SET_PAPER_COORD = 0x0a02
661   0000              defc IOCTL_OTERM_FZX_GET_PAPER_RECT = 0x0b82
662   0000              defc IOCTL_OTERM_FZX_SET_PAPER_RECT = 0x0b02
663   0000              defc IOCTL_OTERM_FZX_LEFT_MARGIN = 0x0c02
664   0000              defc IOCTL_OTERM_FZX_LINE_SPACING = 0x0d02
665   0000              defc IOCTL_OTERM_FZX_SPACE_EXPAND = 0x0e02
666   0000              defc IOCTL_OTERM_FZX_GET_FZX_STATE = 0x0f82
667   0000              defc IOCTL_OTERM_FZX_SET_FZX_STATE = 0x0f02
668   0000              
669   0000              defc IOCTL_ICHAR_CRLF = 0xc103
670   0000              
671   0000              defc IOCTL_OCHAR_CRLF = 0xc014
672   0000              
673   0000              
674   0000              
675   0000              
676   0000              
677   0000              
678   0000              
679   0000              
680   0000              
681   0000              
682   0000              
683   0000              
684   0000              
685   0000              
686   0000              
687   0000              
688   0000              
689   0000              
690   0000              
691   0000              
692   0000              
693   0000              
694   0000              
695   0000              
696   0000              
697   0000              
698   0000              
699   0000              
700   0000              
701   0000              
702   0000              defc __BF_CIO = 0x00
703   0000              defc __BF_CIOIN = 0x0
704   0000              defc __BF_CIOOUT = 0x1
705   0000              defc __BF_CIOIST = 0x2
706   0000              defc __BF_CIOOST = 0x3
707   0000              defc __BF_CIOINIT = 0x4
708   0000              defc __BF_CIOQUERY = 0x5
709   0000              defc __BF_CIODEVICE = 0x6
710   0000              
711   0000              defc __BF_DIO = 0x10
712   0000              defc __BF_DIOSTATUS = 0x10
713   0000              defc __BF_DIORESET = 0x11
714   0000              defc __BF_DIOSEEK = 0x12
715   0000              defc __BF_DIOREAD = 0x13
716   0000              defc __BF_DIOWRITE = 0x14
717   0000              defc __BF_DIOVERIFY = 0x15
718   0000              defc __BF_DIOFORMAT = 0x16
719   0000              defc __BF_DIODEVICE = 0x17
720   0000              defc __BF_DIOMEDIA = 0x18
721   0000              defc __BF_DIODEFMED = 0x19
722   0000              defc __BF_DIOCAP = 0x1a
723   0000              defc __BF_DIOGEOM = 0x1b
724   0000              
725   0000              defc __BF_RTC = 0x20
726   0000              defc __BF_RTCGETTIM = 0x20
727   0000              defc __BF_RTCSETTIM = 0x21
728   0000              defc __BF_RTCGETBYT = 0x22
729   0000              defc __BF_RTCSETBYT = 0x23
730   0000              defc __BF_RTCGETBLK = 0x24
731   0000              defc __BF_RTCSETBLK = 0x25
732   0000              
733   0000              defc __BF_EMU = 0x30
734   0000              
735   0000              defc __BF_VDA = 0x40
736   0000              defc __BF_VDAINI = 0x40
737   0000              defc __BF_VDAQRY = 0x41
738   0000              defc __BF_VDARES = 0x42
739   0000              defc __BF_VDADEV = 0x43
740   0000              defc __BF_VDASCS = 0x44
741   0000              defc __BF_VDASCP = 0x45
742   0000              defc __BF_VDASAT = 0x46
743   0000              defc __BF_VDASCO = 0x47
744   0000              defc __BF_VDAWRC = 0x48
745   0000              defc __BF_VDAFIL = 0x49
746   0000              defc __BF_VDACPY = 0x4a
747   0000              defc __BF_VDASCR = 0x4b
748   0000              defc __BF_VDAKST = 0x4c
749   0000              defc __BF_VDAKFL = 0x4d
750   0000              defc __BF_VDAKRD = 0x4e
751   0000              
752   0000              defc __BF_SYS = 0xF0
753   0000              defc __BF_SYSRESET = 0xf0
754   0000              defc __BF_SYSVER = 0xf1
755   0000              defc __BF_SYSSETBNK = 0xf2
756   0000              defc __BF_SYSGETBNK = 0xf3
757   0000              defc __BF_SYSSETCPY = 0xf4
758   0000              defc __BF_SYSBNKCPY = 0xf5
759   0000              defc __BF_SYSALLOC = 0xf6
760   0000              defc __BF_SYSFREE = 0xf7
761   0000              defc __BF_SYSGET = 0xf8
762   0000              defc __BF_SYSSET = 0xf9
763   0000              defc __BF_SYSPEEK = 0xfa
764   0000              defc __BF_SYSPOKE = 0xfb
765   0000              defc __BF_SYSINT = 0xfc
766   0000              
767   0000              defc __BF_SYSGET_CIOCNT = 0x00
768   0000              defc __BF_SYSGET_DIOCNT = 0x10
769   0000              defc __BF_SYSGET_VDACNT = 0x40
770   0000              defc __BF_SYSGET_TIMER = 0xD0
771   0000              defc __BF_SYSGET_SECS = 0xD1
772   0000              defc __BF_SYSGET_BOOTINFO = 0xE0
773   0000              defc __BF_SYSGET_CPUINFO = 0xF0
774   0000              defc __BF_SYSGET_MEMINFO = 0xF1
775   0000              defc __BF_SYSGET_BNKINFO = 0xF2
776   0000              
777   0000              defc __BF_SYSSET_TIMER = 0xD0
778   0000              defc __BF_SYSSET_SECS = 0xD1
779   0000              defc __BF_SYSSET_BOOTINFO = 0xE0
780   0000              
781   0000              defc __BF_SYSINT_INFO = 0x00
782   0000              defc __BF_SYSINT_GET = 0x10
783   0000              defc __BF_SYSINT_SET = 0x20
784   0000              
785   0000              defc __CIODEV_UART = 0x00
786   0000              defc __CIODEV_ASCI = 0x10
787   0000              defc __CIODEV_TERM = 0x20
788   0000              defc __CIODEV_PRPCON = 0x30
789   0000              defc __CIODEV_PPPCON = 0x40
790   0000              defc __CIODEV_SIO = 0x50
791   0000              defc __CIODEV_ACIA = 0x60
792   0000              defc __CIODEV_PIO = 0x70
793   0000              defc __CIODEV_UF = 0x80
794   0000              defc __CIODEV_CONSOLE = 0xD0
795   0000              
796   0000              defc __DIODEV_MD = 0x00
797   0000              defc __DIODEV_FD = 0x10
798   0000              defc __DIODEV_RF = 0x20
799   0000              defc __DIODEV_IDE = 0x30
800   0000              defc __DIODEV_ATAPI = 0x40
801   0000              defc __DIODEV_PPIDE = 0x50
802   0000              defc __DIODEV_SD = 0x60
803   0000              defc __DIODEV_PRPSD = 0x70
804   0000              defc __DIODEV_PPPSD = 0x80
805   0000              defc __DIODEV_HDSK = 0x90
806   0000              
807   0000              defc __VDADEV_VDU = 0x00
808   0000              defc __VDADEV_CVDU = 0x10
809   0000              defc __VDADEV_NEC = 0x20
810   0000              defc __VDADEV_TMS = 0x30
811   0000              defc __VDADEV_VGA = 0x40
812   0000              
813   0000              defc __EMUTYP_NONE = 0x00
814   0000              defc __EMUTYP_TTY = 0x01
815   0000              defc __EMUTYP_ANSI = 0x02
816   0000              
817   0000              defc __HBX_XFCDAT = 0xffe0
818   0000              defc __HB_CURBNK = 0xffe0
819   0000              defc __HB_INVBNK = 0xffe1
820   0000              defc __HB_SRCADR = 0xffe2
821   0000              defc __HB_SRCBNK = 0xffe4
822   0000              defc __HB_DSTADR = 0xffe5
823   0000              defc __HB_DSTBNK = 0xffe7
824   0000              defc __HB_CPYLEN = 0xffe8
825   0000              
826   0000              defc __HBX_XFCFNS = 0xfff0
827   0000              defc __HB_INVOKE = 0xfff0
828   0000              defc __HB_BNKSEL = 0xfff3
829   0000              defc __HB_BNKCPY = 0xfff6
830   0000              defc __HB_BNKCALL = 0xfff9
831   0000              defc __HB_IDENT = 0xfffe
832   0000              
833   0000              
834   0000              
835   0000              
836   0000              
837   0000              
838   0000              
839   0000              
840   0000              
841   0000              
842   0000              
843   0000              
844   0000              defc __CPM_RCON = 1
845   0000              defc __CPM_WCON = 2
846   0000              defc __CPM_RRDR = 3
847   0000              defc __CPM_WPUN = 4
848   0000              defc __CPM_WLST = 5
849   0000              defc __CPM_DCIO = 6
850   0000              defc __CPM_GIOB = 7
851   0000              defc __CPM_SIOB = 8
852   0000              defc __CPM_PRST = 9
853   0000              defc __CPM_RCOB = 10
854   0000              defc __CPM_ICON = 11
855   0000              defc __CPM_VERS = 12
856   0000              defc __CPM_RDS  = 13
857   0000              defc __CPM_LGIN = 14
858   0000              defc __CPM_OPN  = 15
859   0000              defc __CPM_CLS  = 16
860   0000              defc __CPM_FFST = 17
861   0000              defc __CPM_FNXT = 18
862   0000              defc __CPM_DEL  = 19
863   0000              defc __CPM_READ = 20
864   0000              defc __CPM_WRIT = 21
865   0000              defc __CPM_MAKE = 22
866   0000              defc __CPM_REN  = 23
867   0000              defc __CPM_ILOG = 24
868   0000              defc __CPM_IDRV = 25
869   0000              defc __CPM_SDMA = 26
870   0000              defc __CPM_SUID = 32
871   0000              defc __CPM_RRAN = 33
872   0000              defc __CPM_WRAN = 34
873   0000              defc __CPM_CFS  = 35
874   0000              defc __CPM_DSEG = 51
875   0000              
876   0000              
877   0000              
878   0000              
879   0000              
880   0000              
881   0000              
882   0000              
883   0000              
884   0000              
885   0000              ENDIF
886   0000              
887   0000              
2     0000              
3     0000              SECTION code_rom_resident
4     0000              
5     0000              PUBLIC _context_init
6     0000              
7     0000              ; Only to be done with interrupts disabled, while in kernel space
8     0000              ; void context_init(void (*pc)());
9     0000              _context_init:
10    0000                  ; Copy pc argument to DE
11    0000  E1              pop hl
12    0001  D1              pop de
13    0002  D5              push de
14    0003  E5              push hl
15    0004                  ; Copy _context_temp_sp to HL and SP to _context_temp_sp
16    0004  2A 00 00        ld hl, (_interrupt_sp)
17    0007  ED 73 00 00     ld (_interrupt_sp), sp
18    000B                  ; Use top of reserved user space as stack to prevent overwriting
19    000B  31 02 01        ld sp, nmi_clobberable_tail
20    000E                  ; Put kernel out of address space
21    000E  3E 11           ld a, 0x11
22    0010  ED 39 FA        out0 (CBAR), a
23    0013                  ; Load original _context_temp_sp to SP
24    0013  F9              ld sp, hl
25    0014                  ; Clear HL
26    0014  21 00 00        ld hl, 0
27    0017                  ; Push return address
28    0017  D5              push de
29    0018                  ; Push IX
30    0018  E5              push hl
31    0019                  ; Push AF, AF'
32    0019  E5              push hl
33    001A  E5              push hl
34    001B                  ; Push BC, DE, HL
35    001B  E5              push hl
36    001C  E5              push hl
37    001D  E5              push hl
38    001E                  ; Push BC', DE', HL'
39    001E  E5              push hl
40    001F  E5              push hl
41    0020  E5              push hl
42    0021                  ; Push IY
43    0021  E5              push hl
44    0022                  ; Copy _context_temp_sp to HL and SP to _context_temp_sp
45    0022  2A 00 00        ld hl, (_interrupt_sp)
46    0025  ED 73 00 00     ld (_interrupt_sp), sp
47    0029                  ; Use top of reserved user space as stack to prevent overwriting
48    0029  31 02 01        ld sp, nmi_clobberable_tail
49    002C                  ; Bring kernel into address space
50    002C  3E F1           ld a, 0xF1
51    002E  ED 39 FA        out0 (CBAR), a
52    0031                  ; Restore original SP
53    0031  F9              ld sp, hl
54    0032                  ; Return
55    0032  C9              ret
56    0033              
57    0033              
58    0033              PUBLIC context_save
59    0033              
60    0033              ; Only to be done with interrupts disabled, while in user space
61    0033              context_save:
62    0033                  ; Pop return address to IX while pushing IX
63    0033  DD E3           ex (sp), ix
64    0035                  ; Push AF, AF'
65    0035  F5              push af
66    0036  08              ex af,af'
67    0037  F5              push af
68    0038                  ; Push BC, DE, HL
69    0038  C5              push bc
70    0039  D5              push de
71    003A  E5              push hl
72    003B                  ; Push BC', DE', HL'
73    003B  D9              exx
74    003C  C5              push bc
75    003D  D5              push de
76    003E  E5              push hl
77    003F                  ; Push IY
78    003F  FD E5           push iy
79    0041                  ; Save SP
80    0041  ED 73 00 00     ld (_interrupt_sp), sp
81    0045                  ; Use top of reserved user space as stack to prevent overwriting
82    0045  31 02 01        ld sp, nmi_clobberable_tail
83    0048                  ; Bring kernel into address space
84    0048  3E F1           ld a, 0xF1
85    004A  ED 39 FA        out0 (CBAR), a
86    004D                  ; Use stack at top of kernel space
87    004D  31 00 F0        ld sp, interrupt_stack_tail
88    0050                  ; Push return address from IX
89    0050  DD E5           push ix
90    0052                  ; Return
91    0052  C9              ret
92    0053              
93    0053              
94    0053              PUBLIC context_restore
95    0053              
96    0053              ; Only to be done with interrupts disabled, while in kernel space
97    0053              context_restore:
98    0053                  ; Pop return address to IX
99    0053  DD E1           pop ix
100   0055                  ; Use top of reserved user space as stack to prevent overwriting
101   0055  31 02 01        ld sp, nmi_clobberable_tail
102   0058                  ; Put kernel out of address space
103   0058  3E 11           ld a, 0x11
104   005A  ED 39 FA        out0 (CBAR), a
105   005D                  ; Restore stack location
106   005D  ED 7B 00 00     ld sp, (_interrupt_sp)
107   0061                  ; Pop IY
108   0061  FD E1           pop iy
109   0063                  ; Pop HL', DE', BC'
110   0063  E1              pop hl
111   0064  D1              pop de
112   0065  C1              pop bc
113   0066  D9              exx
114   0067                  ; Pop HL, DE, BC
115   0067  E1              pop hl
116   0068  D1              pop de
117   0069  C1              pop bc
118   006A                  ; Pop AF', AF
119   006A  F1              pop af
120   006B  08              ex af,af'
121   006C  F1              pop af
122   006D                  ; Push return address while popping to IX
123   006D  DD E3           ex (sp),ix
124   006F                  ; Return
125   006F  C9              ret
126   0070              
127   0070              
128   0070              SECTION user_tmp
129   0000              
130   0000              PUBLIC _interrupt_sp
131   0000              _interrupt_sp:
132   0000  00 00           DEFW 0
133   0002              
134   0002              ; Used as a stack when no consistent stack will be available
135   0002              ; SP must always point to a valid stack in case an NMI occurs
136   0002              PUBLIC nmi_clobberable, nmi_clobberable_tail
137   0002              nmi_clobberable:
138   0002  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
      0022  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
      0042  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
      0062  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
      0082  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
      00A2  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
      00C2  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
      00E2  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
                            DEFS 0x100
139   0102              nmi_clobberable_tail:
140   0102              
141   0102              
142   0102              SECTION kernel
143   0000              
144   0000              ; Interrupt stack exists at the top of this section
145   0000              PUBLIC interrupt_stack_tail
146   0000              defc interrupt_stack_tail = 0xF000
147   0000              
